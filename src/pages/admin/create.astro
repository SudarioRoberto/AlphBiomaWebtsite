<!-- src/pages/admin/create.astro -->
---
import Layout from '../../layouts/LayoutAdmin.astro';

export const prerender = false;
const { cookies } = Astro;
const isAuthenticated = cookies.get('admin_auth')?.value === 'true';
if (!isAuthenticated) {
  return new Response(null, {
    status: 302,
    headers: { Location: '/admin/login' }
  });
}

// Verificar se há mensagem de sucesso com senha gerada
const success = Astro.url.searchParams.get('success');
const projectId = Astro.url.searchParams.get('projectId');
const password = Astro.url.searchParams.get('password');
---

<Layout>
  <section class="min-h-screen bg-white text-black px-6 py-28">
    <div class="max-w-2xl mx-auto space-y-8">
      <h1 class="text-3xl font-bold text-blue-900 text-center">Criar Novo Projeto</h1>

      <!-- Exibir mensagem de sucesso se aplicável -->
      {success && projectId && password && (
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6">
          <strong class="font-bold">Projeto criado com sucesso!</strong>
          <p class="block sm:inline mt-1">
            ID do Projeto: <span class="font-mono font-bold">{projectId}</span>
          </p>
          <p class="block sm:inline mt-1">
            Senha: <span class="font-mono font-bold">{password}</span>
          </p>
          <p class="text-sm mt-2">
            ⚠️ Anote ou copie estas informações agora. A senha não será mostrada novamente.
          </p>
        </div>
      )}

      <form method="POST" action="/api/create-project" class="space-y-4">
        <div>
          <label class="block font-semibold mb-1">Nome do Projeto*</label>
          <input type="text" name="projectName" required class="w-full border p-3 rounded" />
        </div>
        
        <div>
          <label class="block font-semibold mb-1">Descrição do Projeto</label>
          <textarea name="description" rows="4" class="w-full border p-3 rounded"></textarea>
        </div>
        
        <div>
          <label class="block font-semibold mb-1">Email do Cliente*</label>
          <input type="email" name="email" required class="w-full border p-3 rounded" />
        </div>
        
        <div>
          <label class="block font-semibold mb-1">Senha Inicial</label>
          <input type="text" name="password" class="w-full border p-3 rounded" />
          <p class="text-sm text-gray-500 mt-1">Uma senha será gerada automaticamente se deixada em branco</p>
        </div>
        
        <div>
          <label class="block font-semibold mb-1">Número de Amostras*</label>
          <input type="number" name="sampleCount" required min="1" value="10" class="w-full border p-3 rounded" />
        </div>
        
        <button type="submit" class="bg-blue-900 text-white px-6 py-3 rounded hover:bg-blue-800 w-full">
          Criar Projeto
        </button>
      </form>
    </div>
  </section>
</Layout>