---
import Layout from '../layouts/Layout.astro';
const currentYear = new Date().getFullYear();
---

<Layout>
  <section class="relative min-h-screen flex flex-col items-center justify-center text-center px-6 md:px-20 bg-black overflow-hidden">
    <video autoplay muted loop playsinline
      class="absolute top-0 left-0 w-full h-full object-cover z-0 opacity-30">
      <source src="/video/dna.mp4" type="video/mp4" />
    </video>
    
    <div class="relative z-10 max-w-md mx-auto">
      <!-- Login Card -->
      <div class="bg-white/10 backdrop-blur-xl p-8 rounded-2xl border border-white/20 shadow-xl">
        <!-- Toggle between client and admin login -->
        <div class="flex bg-white/5 p-1 rounded-lg mb-8">
          <button
            id="clientLoginBtn"
            class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-colors bg-blue-600 text-white"
          >
            Cliente
          </button>
          <button
            id="adminLoginBtn"
            class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-colors text-white/70 hover:text-white"
          >
            Admin
          </button>
        </div>
        
        <h1 id="loginTitle" class="text-2xl font-bold text-white mb-6">Login</h1>
        
        <!-- Client Login Form -->
        <form id="clientLoginForm" class="space-y-6">
          <div>
            <label for="projectId" class="block text-blue-200 text-sm font-medium mb-2">
              ID do Projeto
            </label>
            <input
              type="text"
              id="projectId"
              name="projectId"
              required
              class="w-full p-3 rounded-lg bg-white/5 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 placeholder-white/50"
              placeholder="Digite o ID do seu projeto"
            />
          </div>
          
          <div>
            <label for="clientPassword" class="block text-blue-200 text-sm font-medium mb-2">
              Senha
            </label>
            <input
              type="password"
              id="clientPassword"
              name="password"
              required
              class="w-full p-3 rounded-lg bg-white/5 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 placeholder-white/50"
              placeholder="Digite sua senha"
            />
          </div>
          
          <div class="flex items-center justify-between">
            <a href="https://wa.me/16126663177?text=Ol%C3%A1!%20Gostaria%20de%20falar%20com%20a%20AlphaBioma."" class="text-blue-300 text-sm hover:text-blue-200 transition-colors">
              Esqueceu a senha?
            </a>
            <button
              type="submit"
              class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-400 text-white rounded-lg font-medium hover:shadow-lg hover:shadow-blue-500/30 transform hover:-translate-y-1 transition-all duration-300"
            >
              Entrar
            </button>
          </div>
        </form>
        
        <!-- Admin Login Form (sem alteraÃ§Ãµes por enquanto) -->
        <form id="adminLoginForm" action="/api/admin-login" method="POST" class="hidden space-y-6">
          <div>
            <label for="adminEmail" class="block text-blue-200 text-sm font-medium mb-2">
              Email de Administrador
            </label>
            <input
              type="email"
              id="adminEmail"
              name="email"
              required
              class="w-full p-3 rounded-lg bg-white/5 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 placeholder-white/50"
              placeholder="Digite seu email"
            />
          </div>
          
          <div>
            <label for="adminPassword" class="block text-blue-200 text-sm font-medium mb-2">
              Senha
            </label>
            <input
              type="password"
              id="adminPassword"
              name="password"
              required
              class="w-full p-3 rounded-lg bg-white/5 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 placeholder-white/50"
              placeholder="Digite sua senha"
            />
          </div>
          
          <div class="flex items-center justify-between">
            <a href="https://wa.me/16126663177?text=Ol%C3%A1!%20Gostaria%20de%20falar%20com%20a%20AlphaBioma." class="text-blue-300 text-sm hover:text-blue-200 transition-colors">
              Esqueceu a senha?
            </a>
            <button
              type="submit"
              class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-400 text-white rounded-lg font-medium hover:shadow-lg hover:shadow-blue-500/30 transform hover:-translate-y-1 transition-all duration-300"
            >
              Entrar
            </button>
          </div>
        </form>
      </div>
      
      <!-- Return to homepage link -->
      <div class="mt-8 text-center">
        <a
          href="/"
          class="text-blue-300 hover:text-blue-200 transition-colors flex items-center justify-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 19l-7-7m0 0l7-7m-7 7h18"
            />
          </svg>
          Voltar para a pÃ¡gina inicial
        </a>
      </div>
    </div>
  </section>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const clientLoginBtn = document.getElementById('clientLoginBtn');
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const clientLoginForm = document.getElementById('clientLoginForm');
    const adminLoginForm = document.getElementById('adminLoginForm');
    
    clientLoginBtn.addEventListener('click', function() {
      clientLoginBtn.classList.add('bg-blue-600', 'text-white');
      clientLoginBtn.classList.remove('text-white/70');
      adminLoginBtn.classList.remove('bg-blue-600', 'text-white');
      adminLoginBtn.classList.add('text-white/70');
      clientLoginForm.classList.remove('hidden');
      adminLoginForm.classList.add('hidden');
      document.getElementById('loginTitle').textContent = 'Login de Cliente';
    });
    
    adminLoginBtn.addEventListener('click', function() {
      adminLoginBtn.classList.add('bg-blue-600', 'text-white');
      adminLoginBtn.classList.remove('text-white/70');
      clientLoginBtn.classList.remove('bg-blue-600', 'text-white');
      clientLoginBtn.classList.add('text-white/70');
      adminLoginForm.classList.remove('hidden');
      clientLoginForm.classList.add('hidden');
      document.getElementById('loginTitle').textContent = 'Login de Administrador';
    });

    // ðŸ‘‡ Novo cÃ³digo: login do cliente via fetch
    clientLoginForm.addEventListener('submit', async function (e) {
      e.preventDefault();

      const projectId = document.getElementById('projectId').value;
      const password = document.getElementById('clientPassword').value;

      const res = await fetch('/api/client-login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ projectId, password })
      });

      const data = await res.json();

      if (data.success) {
        window.location.href = `/dashboard/${data.projectId}`; 
      } else {
        alert(data.message);
      }
    });
  });
</script>
